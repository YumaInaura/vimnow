#!/bin/bash -eu

readonly VERSION=0.1.1

for arg in "$@"; do
  if [ "$arg" = '--version' ]; then
    echo "$VERSION"
    exit
  fi
  
  if [ "$arg" = '--update' ]; then
    curl https://raw.githubusercontent.com/yumainaura/vimnow/master/install.sh?$((RANDOM)) | sudo bash; echo
    vimnow --version
    exit
  fi
done

readonly save_dir=${VIMNOW_PATH:-~/vimnow}

mkdir -p "$save_dir"

file_extension=''
for option in "$@"; do
  [ "$option" = '--sh' ] && file_extension='.sh'
done

readonly filepath="$save_dir"/$(date -u | sed 's/ /-/g')-$(date +%s)"$file_extension"

touch "$filepath"
chmod 0755 "$filepath"

echo "${filepath}" > "${save_dir}/.latest_filepath"

vim "${filepath}"
